---
import Layout from '@layouts/Layout.astro';
import Header from '@components/Header.vue';
import Footer from '@components/Footer.vue';
import BlogHome from '@components/blog/BlogHome.vue';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');

// Sort posts by date (newest first), with featured posts at the top
const sortedPosts = posts.sort((a, b) => {
  // Featured posts first
  if (a.data.featured && !b.data.featured) return -1;
  if (!a.data.featured && b.data.featured) return 1;

  // Then by date
  const dateA = a.data.pubDate || a.data.date || new Date();
  const dateB = b.data.pubDate || b.data.date || new Date();
  return dateB.getTime() - dateA.getTime();
});

// Get unique tags sorted alphabetically
const allTags = [...new Set(posts.flatMap(post => post.data.tags || []))].sort();

// Serialize posts for Vue component
const serializedPosts = sortedPosts.map(post => ({
  slug: post.slug,
  data: {
    ...post.data,
    pubDate: post.data.pubDate?.toISOString(),
    date: post.data.date?.toISOString(),
  }
}));
---

<Layout
  title="Smart AI System Decisions - Lattice Guides"
  description="Step-by-step guides to master AI infrastructure research with Lattice. From creating your first workspace to advanced workflows."
  keywords="Lattice guides, AI research tutorials, LLM evaluation, AI infrastructure how-to"
>
  <Header client:load />

  <main>
    <BlogHome
      client:load
      posts={serializedPosts}
      allTags={allTags}
    />
  </main>

  <Footer client:load />
</Layout>
