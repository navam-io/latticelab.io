---
/**
 * Blueprints Gallery Page
 *
 * Showcase page for the 36 curated blueprint bundles available in Lattice Lab.
 * Includes category filtering, vendor logos, and CTAs to pricing.
 *
 * Feature Slice 20: Blueprints Gallery Page
 */
import PageLayout from '@/layouts/PageLayout.astro';
import Section from '@/components/ui/Section.astro';
import Container from '@/components/ui/Container.astro';
import Card from '@/components/ui/Card.astro';
import Button from '@/components/ui/Button.astro';
import { blueprints, categories, getBlueprintCount } from '@/lib/blueprint-data';

// Group blueprints by category for display
const blueprintsByCategory = categories.slice(1).map((cat) => ({
  ...cat,
  blueprints: blueprints.filter((bp) => bp.category === cat.id),
}));

// Stats for the hero
const totalBlueprints = getBlueprintCount();
const totalSources = blueprints.reduce((acc, bp) => acc + bp.sourceCount, 0);
const officialCount = blueprints.filter((bp) => bp.isOfficial).length;

// Icon paths for vendor placeholders
const vendorIconPaths: Record<string, string> = {
  'Anthropic': 'M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5',
  'OpenAI': 'M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4',
  'default': 'M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10',
};

// Category icons
const categoryIcons: Record<string, string> = {
  'Production': 'M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z',
  'Development': 'M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4',
  'Comparison': 'M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z',
  'Enterprise': 'M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4',
  'Research': 'M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z',
  'Cost': 'M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z',
  'Performance': 'M13 10V3L4 14h7v7l9-11h-7z',
};
---

<PageLayout
  title="Blueprint Gallery - Lattice Lab"
  description="Explore 36 curated blueprint bundles for AI research. Pre-configured sources for Anthropic, OpenAI, AWS, Google, Meta, and more. Start researching in seconds."
>
  <!-- Hero Section -->
  <Section spacing="lg" background="default" data-testid="blueprints-hero">
    <Container size="lg">
      <div class="mx-auto max-w-3xl text-center">
        <span
          class="mb-4 inline-block rounded-full bg-accent/10 px-4 py-1.5 text-sm font-medium text-accent"
          data-testid="blueprints-eyebrow"
        >
          Blueprint Gallery
        </span>
        <h1
          class="mb-6 text-4xl font-bold tracking-tight text-foreground sm:text-5xl"
          data-testid="blueprints-headline"
        >
          Pre-Configured AI Research Bundles
        </h1>
        <p
          class="mb-8 text-xl text-muted-foreground"
          data-testid="blueprints-subhead"
        >
          Start researching immediately with curated source bundles for 36 vendors. Each blueprint includes documentation, pricing, and best practices.
        </p>

        <!-- Stats Row -->
        <div class="flex flex-wrap items-center justify-center gap-8" data-testid="blueprints-stats">
          <div class="text-center" data-testid="blueprints-stat-total">
            <div class="text-3xl font-bold text-accent">{totalBlueprints}</div>
            <div class="text-sm text-muted-foreground">Blueprints</div>
          </div>
          <div class="text-center" data-testid="blueprints-stat-sources">
            <div class="text-3xl font-bold text-accent">{totalSources}</div>
            <div class="text-sm text-muted-foreground">Total Sources</div>
          </div>
          <div class="text-center" data-testid="blueprints-stat-official">
            <div class="text-3xl font-bold text-accent">{officialCount}</div>
            <div class="text-sm text-muted-foreground">Official Vendors</div>
          </div>
        </div>
      </div>
    </Container>
  </Section>

  <!-- Category Filter Tabs -->
  <Section spacing="sm" background="muted" data-testid="blueprints-filters">
    <Container size="lg">
      <div class="flex flex-wrap items-center justify-center gap-2" data-testid="blueprints-filter-tabs">
        {categories.map((cat, index) => (
          <a
            href={cat.id === 'All' ? '#all-blueprints' : `#category-${cat.id.toLowerCase()}`}
            class={`inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-medium transition-colors ${
              index === 0
                ? 'bg-accent text-white'
                : 'bg-background text-muted-foreground hover:bg-surface-2 hover:text-foreground'
            }`}
            data-testid={`blueprints-filter-${cat.id.toLowerCase()}`}
          >
            {cat.id !== 'All' && (
              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={categoryIcons[cat.id]} />
              </svg>
            )}
            {cat.label}
          </a>
        ))}
      </div>
    </Container>
  </Section>

  <!-- Blueprint Categories -->
  {blueprintsByCategory.map((category, categoryIndex) => (
    <Section
      spacing="lg"
      background={categoryIndex % 2 === 0 ? 'default' : 'muted'}
      data-testid={`blueprints-category-${category.id.toLowerCase()}`}
    >
      <Container size="lg">
        <div class="mb-8" id={`category-${category.id.toLowerCase()}`}>
          <div class="flex items-center gap-3 mb-2">
            <div class="flex h-10 w-10 items-center justify-center rounded-lg bg-accent/10">
              <svg class="h-5 w-5 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={categoryIcons[category.id]} />
              </svg>
            </div>
            <h2
              class="text-2xl font-bold tracking-tight text-foreground"
              data-testid={`blueprints-category-${category.id.toLowerCase()}-title`}
            >
              {category.label}
            </h2>
          </div>
          <p class="text-muted-foreground ml-13" data-testid={`blueprints-category-${category.id.toLowerCase()}-description`}>
            {category.description}
          </p>
        </div>

        <div
          class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"
          data-testid={`blueprints-category-${category.id.toLowerCase()}-grid`}
        >
          {category.blueprints.map((blueprint, bpIndex) => {
            const globalIndex = blueprints.findIndex((bp) => bp.id === blueprint.id);
            return (
              <Card
                padding="md"
                class="group relative flex flex-col transition-all hover:shadow-lg hover:border-accent/30"
                data-testid={`blueprint-card-${globalIndex}`}
              >
                {/* Vendor Logo Placeholder */}
                <div class="mb-4 flex items-center justify-between">
                  <div
                    class="flex h-12 w-12 items-center justify-center rounded-lg bg-surface-2"
                    data-testid={`blueprint-card-${globalIndex}-logo`}
                  >
                    <svg
                      class="h-6 w-6 text-muted-foreground"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      aria-hidden="true"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="1.5"
                        d={vendorIconPaths[blueprint.vendor] || vendorIconPaths['default']}
                      />
                    </svg>
                  </div>
                  {blueprint.isOfficial && (
                    <span
                      class="inline-flex items-center gap-1 rounded-full bg-yellow-100 px-2 py-0.5 text-xs font-medium text-yellow-800"
                      data-testid={`blueprint-card-${globalIndex}-official`}
                    >
                      <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                      </svg>
                      Official
                    </span>
                  )}
                </div>

                {/* Blueprint Info */}
                <div class="mb-2 flex items-center gap-2">
                  <span
                    class="text-xs text-muted-foreground"
                    data-testid={`blueprint-card-${globalIndex}-vendor`}
                  >
                    {blueprint.vendor}
                  </span>
                  <span class="text-muted-foreground/50">â€¢</span>
                  <span
                    class="text-xs text-muted-foreground"
                    data-testid={`blueprint-card-${globalIndex}-sources`}
                  >
                    {blueprint.sourceCount} sources
                  </span>
                </div>

                {/* Blueprint Name */}
                <h3
                  class="mb-2 text-lg font-semibold text-foreground"
                  data-testid={`blueprint-card-${globalIndex}-name`}
                >
                  {blueprint.name}
                </h3>

                {/* Blueprint Description */}
                <p
                  class="mb-4 flex-1 text-sm text-muted-foreground"
                  data-testid={`blueprint-card-${globalIndex}-description`}
                >
                  {blueprint.description}
                </p>

                {/* Tags */}
                <div class="mb-4 flex flex-wrap gap-1.5" data-testid={`blueprint-card-${globalIndex}-tags`}>
                  {blueprint.tags.slice(0, 3).map((tag) => (
                    <span class="rounded-full bg-surface-2 px-2 py-0.5 text-xs text-muted-foreground">
                      {tag}
                    </span>
                  ))}
                </div>

                {/* CTA Link */}
                <a
                  href="/pricing"
                  class="inline-flex items-center gap-2 text-sm font-medium text-accent transition-colors hover:text-accent/80"
                  data-testid={`blueprint-card-${globalIndex}-cta`}
                >
                  Try with Lattice
                  <svg
                    class="h-4 w-4 transition-transform group-hover:translate-x-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    aria-hidden="true"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                  </svg>
                </a>
              </Card>
            );
          })}
        </div>
      </Container>
    </Section>
  ))}

  <!-- Summary Section -->
  <Section spacing="lg" background="default" data-testid="blueprints-summary" id="all-blueprints">
    <Container size="lg">
      <div class="mx-auto max-w-4xl text-center">
        <h2 class="mb-4 text-2xl font-bold tracking-tight text-foreground" data-testid="blueprints-summary-headline">
          All {totalBlueprints} Blueprints Included
        </h2>
        <p class="mb-8 text-lg text-muted-foreground" data-testid="blueprints-summary-subhead">
          Every blueprint bundle is included with your $99 Lattice Lab purchase. Apply them instantly to any workspace.
        </p>

        <!-- Vendor Grid -->
        <div class="grid grid-cols-3 gap-4 sm:grid-cols-4 md:grid-cols-6" data-testid="blueprints-vendor-grid">
          {[...new Set(blueprints.map((bp) => bp.vendor))].slice(0, 12).map((vendor, index) => (
            <div
              class="flex flex-col items-center gap-2 rounded-lg bg-surface-2 p-4"
              data-testid={`blueprints-vendor-${index}`}
            >
              <div class="flex h-10 w-10 items-center justify-center rounded-full bg-background">
                <svg class="h-5 w-5 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d={vendorIconPaths['default']} />
                </svg>
              </div>
              <span class="text-xs font-medium text-muted-foreground text-center">{vendor}</span>
            </div>
          ))}
        </div>
      </div>
    </Container>
  </Section>

  <!-- CTA Section -->
  <Section spacing="lg" background="muted" data-testid="blueprints-cta">
    <Container size="md">
      <div class="text-center">
        <h2
          class="mb-4 text-2xl font-bold tracking-tight text-foreground sm:text-3xl"
          data-testid="blueprints-cta-headline"
        >
          Ready to Start Researching?
        </h2>
        <p
          class="mb-8 text-lg text-muted-foreground"
          data-testid="blueprints-cta-subhead"
        >
          Get all {totalBlueprints} blueprints with your Lattice Lab purchase. Apply any blueprint instantly.
        </p>
        <div class="flex flex-col items-center gap-4 sm:flex-row sm:justify-center" data-testid="blueprints-cta-buttons">
          <Button
            variant="primary"
            size="lg"
            href="/pricing"
            class="w-full px-8 sm:w-auto"
            data-testid="blueprints-cta-primary"
          >
            Get Lattice for $99
          </Button>
          <Button
            variant="secondary"
            size="lg"
            href="/features/sources"
            class="w-full px-8 sm:w-auto"
            data-testid="blueprints-cta-secondary"
          >
            Learn About Sources
          </Button>
        </div>
        <p class="mt-6 text-sm text-muted-foreground" data-testid="blueprints-cta-trust">
          30-day money-back guarantee. All blueprints included.
        </p>
      </div>
    </Container>
  </Section>
</PageLayout>
