---
/**
 * InteractivePreview Section Component
 *
 * Homepage section showcasing the ChatPreview interactive demo.
 * Includes scroll-triggered animation and CTA to features.
 *
 * Feature Slice 30: Homepage Interactive Preview Section
 */
import Section from '@/components/ui/Section.astro';
import Container from '@/components/ui/Container.astro';
import Button from '@/components/ui/Button.astro';
import { ChatPreview } from '@/components/previews/ChatPreview';
---

<Section spacing="xl" background="default" data-testid="interactive-preview-section">
  <Container size="lg">
    <div class="interactive-preview-wrapper" data-animate="fade-up">
      <!-- Section Header -->
      <div class="mx-auto mb-12 max-w-3xl text-center">
        <!-- Eyebrow -->
        <div class="mb-4 flex items-center justify-center gap-2">
          <div class="h-px w-8 bg-accent"></div>
          <span
            class="text-sm font-medium uppercase tracking-wider text-accent"
            data-testid="interactive-preview-eyebrow"
          >
            Interactive Demo
          </span>
          <div class="h-px w-8 bg-accent"></div>
        </div>

        <!-- Headline -->
        <h2
          class="mb-4 text-3xl font-bold tracking-tight text-foreground sm:text-4xl lg:text-5xl"
          data-testid="interactive-preview-headline"
        >
          See Lattice in Action
        </h2>

        <!-- Description -->
        <p
          class="mx-auto max-w-2xl text-lg text-muted-foreground"
          data-testid="interactive-preview-description"
        >
          Experience how Lattice Lab's AI chat works. Watch streaming responses with source citations,
          thinking steps, and artifact generation â€” all powered by your private knowledge base.
        </p>
      </div>

      <!-- Preview Container -->
      <div
        class="mx-auto max-w-4xl"
        data-testid="interactive-preview-container"
      >
        <div class="preview-wrapper rounded-xl border border-border bg-surface-1 p-4 shadow-lg sm:p-6">
          <ChatPreview client:visible />
        </div>

        <!-- Caption -->
        <p
          class="mt-4 text-center text-sm text-muted-foreground"
          data-testid="interactive-preview-caption"
        >
          This is a simulated demo. The actual product connects to your AI providers and knowledge sources.
        </p>
      </div>

      <!-- CTA -->
      <div class="mt-10 flex flex-col items-center gap-4 sm:flex-row sm:justify-center" data-testid="interactive-preview-cta">
        <Button
          variant="primary"
          size="lg"
          href="/features"
          class="w-full px-8 sm:w-auto"
          data-testid="interactive-preview-cta-primary"
          data-track="cta"
          data-track-name="Interactive Preview Features CTA"
        >
          Explore All Features
        </Button>
        <Button
          variant="secondary"
          size="lg"
          href="/pricing"
          class="w-full px-8 sm:w-auto"
          data-testid="interactive-preview-cta-secondary"
          data-track="cta"
          data-track-name="Interactive Preview Pricing CTA"
        >
          Get Lattice for $99
        </Button>
      </div>
    </div>
  </Container>
</Section>

<style>
  /* Scroll-triggered animation */
  .interactive-preview-wrapper {
    opacity: 0;
    transform: translateY(30px);
    transition:
      opacity 0.6s ease-out,
      transform 0.6s ease-out;
  }

  .interactive-preview-wrapper.animate-in {
    opacity: 1;
    transform: translateY(0);
  }

  /* Preview wrapper styling */
  .preview-wrapper {
    background: linear-gradient(
      180deg,
      var(--color-surface-1) 0%,
      var(--color-surface-2) 100%
    );
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .interactive-preview-wrapper {
      opacity: 1;
      transform: none;
      transition: none;
    }
  }
</style>

<script>
  // Intersection Observer for scroll-triggered animation
  const observerOptions = {
    root: null,
    rootMargin: '0px',
    threshold: 0.1,
  };

  const handleIntersection = (entries: IntersectionObserverEntry[], observer: IntersectionObserver) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add('animate-in');
        observer.unobserve(entry.target);
      }
    });
  };

  // Only run animation if user hasn't disabled motion
  if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
    const observer = new IntersectionObserver(handleIntersection, observerOptions);
    const wrapper = document.querySelector('.interactive-preview-wrapper');
    if (wrapper) {
      observer.observe(wrapper);
    }
  } else {
    // If reduced motion is preferred, show content immediately
    const wrapper = document.querySelector('.interactive-preview-wrapper');
    if (wrapper) {
      wrapper.classList.add('animate-in');
    }
  }
</script>
