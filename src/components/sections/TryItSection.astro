---
/**
 * TryItSection Component
 *
 * A dedicated section for displaying interactive preview components
 * on feature pages. Includes headline, description, and the preview.
 *
 * Feature Slice 29: Integrate Previews into Feature Pages
 */
interface Props {
  headline?: string;
  description?: string;
  featureSlug: string;
  colorScheme?: 'blue' | 'purple' | 'green' | 'orange';
}

const {
  headline = 'Try It Yourself',
  description = 'Interact with this demo to see how it works.',
  featureSlug,
  colorScheme = 'blue',
} = Astro.props;

// Import preview components dynamically based on feature
import { ChatPreview } from '@/components/previews/ChatPreview';
import { SourcesPreview } from '@/components/previews/SourcesPreview';
import { BlueprintPreview } from '@/components/previews/BlueprintPreview';
import { ScenarioPreview } from '@/components/previews/ScenarioPreview';
import Section from '@/components/ui/Section.astro';
import Container from '@/components/ui/Container.astro';

// Color mapping for accent styling
const colorClasses = {
  blue: 'text-blue-600',
  purple: 'text-purple-600',
  green: 'text-green-600',
  orange: 'text-orange-600',
};

const accentColor = colorClasses[colorScheme];

// Map feature slugs to their preview components
const previewMap: Record<string, string> = {
  lab: 'chat',
  sources: 'sources',
  scenarios: 'scenario',
};

const previewType = previewMap[featureSlug];
---

<Section spacing="lg" background="default" data-testid="try-it-section">
  <Container size="lg">
    <div class="mx-auto max-w-4xl">
      <!-- Section Header -->
      <div class="mb-8 text-center">
        <div class="mb-2 flex items-center justify-center gap-2">
          <svg
            class={`h-5 w-5 ${accentColor}`}
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"
            />
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <span class={`text-sm font-medium uppercase tracking-wider ${accentColor}`}>
            Interactive Demo
          </span>
        </div>
        <h2
          class="mb-3 text-2xl font-bold tracking-tight text-foreground sm:text-3xl"
          data-testid="try-it-headline"
        >
          {headline}
        </h2>
        <p
          class="mx-auto max-w-2xl text-muted-foreground"
          data-testid="try-it-description"
        >
          {description}
        </p>
      </div>

      <!-- Preview Component -->
      <div class="try-it-preview" data-testid="try-it-preview">
        {previewType === 'chat' && (
          <ChatPreview client:visible />
        )}
        {previewType === 'sources' && (
          <div class="space-y-8">
            <SourcesPreview client:visible />
            <div class="pt-4">
              <p class="mb-4 text-center text-sm text-muted-foreground">
                See how sources power AI-generated content:
              </p>
              <BlueprintPreview client:visible />
            </div>
          </div>
        )}
        {previewType === 'scenario' && (
          <ScenarioPreview client:visible />
        )}
      </div>

      <!-- Reduced Motion Notice -->
      <noscript>
        <div class="mt-4 rounded-lg border border-border bg-surface-2 p-4 text-center text-sm text-muted-foreground">
          This interactive demo requires JavaScript. Please enable JavaScript to experience the full functionality.
        </div>
      </noscript>
    </div>
  </Container>
</Section>

<style>
  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .try-it-preview :global(*) {
      animation-duration: 0.001ms !important;
      transition-duration: 0.001ms !important;
    }
  }

  /* Mobile optimization */
  @media (max-width: 640px) {
    .try-it-preview {
      margin-left: -1rem;
      margin-right: -1rem;
    }
  }
</style>
